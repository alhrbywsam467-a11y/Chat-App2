<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ ÙˆØ³Ø§Ù… Ù„Ù„Ù…Ø±Ø§Ø³Ù„Ø© Pro</title>
    <style>
        /* Ø³Ø£Ø¨Ù‚ÙŠ ØªÙ†Ø³ÙŠÙ‚Ø§ØªÙƒ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù„Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #111b21; height: 100vh; overflow: hidden; }
        .container { display: flex; height: 100vh; max-width: 1600px; margin: 0 auto; }
        .sidebar { width: 400px; background: #111b21; border-left: 1px solid #2a3942; display: flex; flex-direction: column; }
        .sidebar-header { background: #202c33; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .user-info { display: flex; align-items: center; gap: 10px; padding: 10px; background: #2a3942; border-radius: 8px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .header-buttons { display: flex; gap: 5px; width: 100%; }
        .header-buttons button { flex: 1; padding: 8px; border-radius: 20px; border: none; cursor: pointer; font-size: 12px; font-weight: bold; color: white; transition: 0.3s; }
        .share-link-btn { background: #0088cc; }
        .add-user-btn { background: #25d366; }
        .my-profile-btn { background: #667eea; }
        .contacts-list { flex: 1; overflow-y: auto; }
        .contact { padding: 15px; border-bottom: 1px solid #2a3942; cursor: pointer; display: flex; align-items: center; gap: 15px; color: white; }
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #0b141a; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #202c33; padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; color: white; }
        .modal-content input { width: 100%; padding: 12px; margin: 10px 0; background: #2a3942; border: none; color: white; border-radius: 8px; }
        .welcome-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #111b21; color: white; }
        .welcome-screen input { padding: 15px; margin: 10px; border-radius: 8px; border: none; width: 300px; }
        .welcome-screen button { padding: 15px 30px; background: #25d366; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div id="welcomeScreen" class="welcome-screen">
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Wesam Pro! ğŸ‘‹</h1>
        <input type="text" id="userNameInput" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¸Ø§Ù‡Ø±">
        <input type="text" id="userUsernameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (ID)">
        <button onclick="saveUserName()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-info" id="userInfo"></div>
                <div class="header-buttons">
                    <button class="share-link-btn" onclick="openShareLinkModal()">ğŸ“¤ Ø±Ø§Ø¨Ø·ÙŠ</button>
                    <button class="add-user-btn" onclick="openAddFriendModal()">â• Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚</button>
                    <button class="my-profile-btn" onclick="location.reload()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                </div>
            </div>
            <div class="contacts-list" id="contactsList"></div>
        </div>
        <div class="chat-area" id="chatArea">
            <div style="color: #8696a0; text-align: center; margin-top: 50vh;">Ø§Ø®ØªØ± ØµØ¯ÙŠÙ‚Ø§Ù‹ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</div>
        </div>
    </div>

    <div class="modal" id="addFriendModal">
        <div class="modal-content">
            <h3>Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</h3>
            <p>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ID) Ù„ØµØ¯ÙŠÙ‚Ùƒ:</p>
            <input type="text" id="friendIdInput" placeholder="Ù…Ø«Ø§Ù„: wesam_2026">
            <div style="display:flex; gap:10px;">
                <button onclick="addFriendAction()" style="flex:1; padding:10px; background:#25d366; border:none; color:white; border-radius:8px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ©</button>
                <button onclick="closeModal('addFriendModal')" style="flex:1; padding:10px; background:#374248; border:none; color:white; border-radius:8px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div class="modal" id="shareLinkModal">
        <div class="modal-content">
            <h3>Ø±Ø§Ø¨Ø· Ø¯Ø¹ÙˆØªÙƒ Ø§Ù„Ø®Ø§Øµ</h3>
            <input type="text" id="shareLinkInput" readonly>
            <button onclick="copyInviteLink()" style="width:100%; padding:10px; background:#0088cc; border:none; color:white; border-radius:8px; cursor:pointer;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            <button onclick="closeModal('shareLinkModal')" style="width:100%; padding:10px; background:none; color:#8696a0; border:none; cursor:pointer; margin-top:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY", // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§
            authDomain: "conversations-4cdea.firebaseapp.com",
            databaseURL: "https://conversations-4cdea-default-rtdb.firebaseio.com",
            projectId: "conversations-4cdea",
            storageBucket: "conversations-4cdea.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let myId = localStorage.getItem('userId');
        let myName = localStorage.getItem('userName');

        // Ù…ÙŠØ²Ø© ÙØ­Øµ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        const urlParams = new URLSearchParams(window.location.search);
        const invitedBy = urlParams.get('invite');

        if (myId) {
            startApp();
            if (invitedBy && invitedBy !== myId) autoAddFriend(invitedBy);
        }

        window.saveUserName = async function() {
            const name = document.getElementById('userNameInput').value;
            const username = document.getElementById('userUsernameInput').value.trim();
            if (!name || !username) return alert("Ø§Ù…Ù„Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§ Ø¨Ø·Ù„");

            myId = username;
            myName = name;
            localStorage.setItem('userId', myId);
            localStorage.setItem('userName', myName);

            await set(ref(db, 'users/' + myId), { name: myName, id: myId });
            startApp();
        };

        function startApp() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            document.getElementById('userInfo').innerHTML = `
                <div class="user-avatar">${myName[0]}</div>
                <div><div>${myName}</div><small style="color:#8696a0">@${myId}</small></div>
            `;
            loadContacts();
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚ Ø¨Ø§Ù„ÙŠÙˆØ²Ø± (ÙŠØ¯ÙˆÙŠØ§Ù‹)
        window.addFriendAction = async function() {
            const friendId = document.getElementById('friendIdInput').value.trim();
            if (friendId === myId) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù†ÙØ³Ùƒ!");
            
            const snapshot = await get(ref(db, 'users/' + friendId));
            if (snapshot.exists()) {
                await autoAddFriend(friendId);
                alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµØ¯ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!");
                closeModal('addFriendModal');
            } else {
                alert("Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±");
            }
        };

        async function autoAddFriend(friendId) {
            const friendData = (await get(ref(db, 'users/' + friendId))).val();
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµØ¯ÙŠÙ‚ Ø¹Ù†Ø¯ÙŠ
            await set(ref(db, `contacts/${myId}/${friendId}`), { name: friendData.name, id: friendId });
            // Ø¥Ø¶Ø§ÙØªÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØµØ¯ÙŠÙ‚
            await set(ref(db, `contacts/${friendId}/${myId}`), { name: myName, id: myId });
        }

        function loadContacts() {
            onValue(ref(db, 'contacts/' + myId), (snapshot) => {
                const list = document.getElementById('contactsList');
                list.innerHTML = "";
                snapshot.forEach((child) => {
                    const contact = child.val();
                    list.innerHTML += `<div class="contact" onclick="alert('Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© ${contact.name}')">
                        <div class="user-avatar" style="background:#25d366">${contact.name[0]}</div>
                        <div>${contact.name} <br> <small>@${contact.id}</small></div>
                    </div>`;
                });
            });
        }

        window.openShareLinkModal = function() {
            document.getElementById('shareLinkInput').value = window.location.origin + window.location.pathname + "?invite=" + myId;
            document.getElementById('shareLinkModal').classList.add('active');
        };

        window.openAddFriendModal = () => document.getElementById('addFriendModal').classList.add('active');
        window.closeModal = (id) => document.getElementById(id).classList.remove('active');
        window.copyInviteLink = () => {
            navigator.clipboard.writeText(document.getElementById('shareLinkInput').value);
            alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø·Ùƒ!");
        };

    </script>
</body>
</html>
